<?php
	$cs = Yii::app()->getClientScript();
	$cs->registerScriptFile(baseurl().'/js/vue.js',CClientScript::POS_BEGIN);
    $cs->registerScriptFile(baseurl().'/js/vuetify.js',CClientScript::POS_BEGIN);
    $cs->registerScriptFile(baseurl().'/js/axios.js',CClientScript::POS_BEGIN);
    $baseUrl=Yii::app()->baseUrl;
?>
<script type="text/javascript">
	//var last7dayUrl=<?=$baseUrl.'/raffle/GetResult7day'?>
	//alert(last7dayUrl)
	new Vue({
        el: '#app' ,
        data(){
            return{
                hide:false,
                dialog:false,
                dialog2:false,
                dialog3:true,
                credit:1000,
                price:0,
                betAmount:10,
                spinNumber:0,
                spining:false,
                luckyDraw:[], //should return value from database
                current:'',
                links: ['Home', 'About Us', 'Team', 'Services', 'Contact Us'],
                menus:[
                    {text:'Online Casino',link:'http://localhost/bakou-raffle/index.php/Raffle/OnlineCasino'},
                    {text:'Online Sport',link:'http://localhost/bakou-raffle/index.php/Raffle/OnlineSport'},
                    {text:'Online Lottery',link:'http://localhost/bakou-raffle/index.php/Raffle/OnlineLottery'},
                    {text:'Online Raffle',link:'#'},
                    {text:'Promotion',link:'http://localhost/bakou-raffle/index.php/Raffle/Promotion/'},
                    {text:'Raffle Result',link:'#'},
                ],
                fmenus:[
                    {text:'หน้าหลัก',link:'http://www.winwin97.com/'},
                    {text:'คาสิโนออนไลน์',link:'http://www.winwin97.com/casino/'},
                    {text:'สปอร์ตออนไลน์',link:'http://www.winwin97.com/sport/'},
                    {text:'หวยออนไลน์',link:'http://www.winwin97.com/lotto/'},
                    {text:'สมัครสมาชิก',link:'http://www.winwin97.com/register/'},
                    {text:'โปรโมชั่น',link:'http://www.winwin97.com/promotion/'},
                    {text:'แจ้งฝาก – แจ้งถอน',link:'http://www.winwin97.com/banking/'},
                    {text:'LIVE SCORE',link:'http://www.winwin97.com/live-score/'},
                    {text:'ติดต่อเรา',link:'http://www.winwin97.com/contact/'},
                ],
                items: [
                    { src: 'http://www.winwin97.com/wp-content/uploads/2017/03/slide02.jpg' },
                    { src: 'http://www.winwin97.com/wp-content/uploads/2017/03/slide03.jpg?v=1.0' },
                    { src: 'http://www.winwin97.com/wp-content/uploads/2017/03/slide04.jpg?v=1.0' }
                ],
                lotteries:[],
                menu1: null,
                menu2: null,
                clientHistory: [],
                start_date: null,
                end_date: null,
                price_categories: [],
                raffle_results:[],
                client_raffle_history:[]
            }
        },
        created(){
            this.Spin()
            this.insertLuckyNumber(0)
            this.getLast7DaysResult()

            var start_date = new Date();
            // start_date.setDate()

            var end_date = new Date();
            // end_date.setDate()

            this.start_date = start_date.getFullYear() + '-' + (start_date.getMonth()+1 < 10 ? '0' + (start_date.getMonth()+1) : start_date.getMonth()+1) + '-' + (start_date.getDate()-1)
            this.end_date = end_date.getFullYear() + '-' + (end_date.getMonth()+1 < 10 ? '0' + (end_date.getMonth()+1) : end_date.getMonth()+1) + '-' + end_date.getDate()

            this.getPrizeCategory()
            this.getClientRaffleHistory()
            this.getClientHistory()
        },
        watch:{
            price:function(){
                if(this.price>0){
                    this.betAmount=this.price
                }else if(parseInt(this.price)>parseInt(this.credit)){
                    this.dialog=true
                }
            }
        },
        methods:{
            getLast7DaysResult(){
                var vm=this
                axios.get('<?php echo Yii::app()->createUrl('/raffle/GetResult7day')?>')
                  .then(function (response) {
                    vm.lotteries=response.data;
                  })
                  .catch(function (error) {
                    console.log(error);
                  });
            },
            Spin:function(){
                var vm=this
                vm.spining=!vm.spining
                var spiningRun=setInterval(function(){
                    if(vm.spining==true){
                        vm.spinNumber=Math.random().toString().slice(2,6) //This number are generated by db already?
                    }else{
                        clearInterval(spiningRun)
                    }
                },100);
            },
            bet(){
                if(parseInt(this.betAmount)>0 & parseInt(this.betAmount)<=parseInt(this.credit)){
                    this.credit=parseInt(this.credit)-parseInt(this.betAmount)
                    this.betAmount=this.price
                    this.price=0
                }else{
                    this.credit=parseInt(this.credit)
                }
            },
            insertLuckyNumber(act){ //this is will use sql/database instead

            	var vm=this
                axios.get('<?php echo Yii::app()->createUrl('/raffle/PickupTicket?act=')?>'+act)
                  .then(function (response) {
                    vm.luckyDraw=response.data.result;
                    vm.credit=response.data.balance;
                  })
                  .catch(function (error) {
                    console.log(error);
                  });

                // if(this.credit>0){
                //     this.credit=parseInt(this.credit)-parseInt(this.betAmount)
                //     this.luckyDraw.push({price:this.betAmount,luckyNum:this.spinNumber})
                // }else{

                // }

            },
            resetAmount(){
                this.price=this.credit
                this.dialog=false;
            },
						getClientHistory(){
							var vm = this
							axios.get('<?php echo Yii::app()->createUrl('/raffle/GetClientHistory?sdate=')?>' + vm.start_date + '&edate=' + vm.end_date)
								.then(function (response) {
									vm.clientHistory = response.data
								})
								.catch(function (error) {
									console.log(error);
								});
						},
						getRaffleResult(){
							var vm = this
							axios.get('<?php echo Yii::app()->createUrl('/raffle/GetClientResult?sdate=')?>' + vm.start_date + '&edate=' + vm.end_date)
								.then(function (response) {
									vm.raffle_results = response.data
								})
								.catch(function (error) {
									console.log(error);
								});
						},
						getPrizeCategory(){
							var vm = this
							axios.get('<?php echo Yii::app()->createUrl('raffle/GetPrizeCategory')?>')
								.then(function (response) {
									vm.price_categories = response.data
								})
								.catch(function (error) {
									console.log(error);
								});
						},
						getClientRaffleHistory(){
							var vm = this
							axios.get('<?php echo Yii::app()->createUrl('raffle/GetClientRaffleHistory')?>')
								.then(function (response) {
									vm.client_raffle_history = response.data
								})
								.catch(function (error) {
									console.log(error);
								});
						}

        }
    })
</script>
